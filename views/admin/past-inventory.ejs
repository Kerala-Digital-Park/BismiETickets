<%- include('./partials/header') %>

<!-- **************** MAIN CONTENT START **************** -->

<main>

	<!-- Sidebar START -->
	<%- include('./partials/sideBar') %>
	<!-- Sidebar END -->
	
	<!-- Page content START -->
	<div class="page-content">
	
		<!-- Top bar START -->
		<%- include('./partials/topBar') %>
		<!-- Top bar END -->

        <!-- Page main content START -->
        <div class="page-content-wrapper p-xxl-4">

            <!-- Title -->
            <div class="row">
                <div class="col-12 mb-5">
                    <div class="d-sm-flex justify-content-between align-items-center">
                        <h1 class="h4 mb-2 mb-sm-0">Past Inventory History</h1>
                        <div class="d-grid"><a href="/admin/add-flight" class="btn btn-primary-soft mb-0"><i
                                    class="bi bi-plus-lg fa-fw"></i> Add New Inventory</a></div>
                    </div>
                </div>
            </div>

            <!-- Counter START -->
				<div class="row g-4 mb-5">
					<!-- Counter item -->
					<div class="col-md-6 col-xxl-3">
						<div class="card card-body shadow p-4">
							<div class="d-flex justify-content-between align-items-center mb-3">
								<!-- Number -->
								<div class="me-2">
									<span>All <br>Inventory</span>
									<h3 class="mb-0 mt-2"><%= totalFlights %></h3>
								</div>
								<!-- Icon -->
								<div
									class="icon-lg rounded-circle flex-shrink-0 bg-primary bg-opacity-10 text-primary mb-0">
									<i class="bi bi-ticket fa-fw"></i>
								</div>
							</div>
							<!-- Progress bar -->
							<!-- <div class="progress progress-xs bg-primary bg-opacity-10 mb-2">
								<div class="progress-bar bg-primary" role="progressbar"
									style="width: 60%" aria-valuenow="60" aria-valuemin="0"
									aria-valuemax="100">
								</div>
							</div>
							<span><span class="text-primary">50 Upcoming</span> on May 2025</span> -->
						</div>
					</div>

					<!-- Counter item -->
					<div class="col-md-6 col-xxl-3">
						<div class="card card-body shadow p-4">
							<div class="d-flex justify-content-between align-items-center mb-3">
								<!-- Number -->
								<div class="me-2">
									<span>Active <br> Inventory</span>
									<h3 class="mb-0 mt-2"><%= activeFlights %></h3>
								</div>
								<!-- Icon -->
								<div
									class="icon-lg rounded-circle flex-shrink-0 bg-success bg-opacity-10 text-success mb-0">
									<i class="bi bi-ticket-perforated-fill fa-fw"></i>
								</div>
							</div>
							<!-- Progress bar -->
							<!-- <div class="progress progress-xs bg-success bg-opacity-10 mb-2">
								<div class="progress-bar bg-success" role="progressbar"
									style="width: 60%" aria-valuenow="60" aria-valuemin="0"
									aria-valuemax="100">
								</div>
							</div>
							<span><span class="text-success">125 Completed flights</span> on May
								2025</span> -->
						</div>
					</div>

					<!-- Counter item -->
					<div class="col-md-6 col-xxl-3">
						<div class="card card-body shadow p-4">
							<div class="d-flex justify-content-between align-items-center mb-3">
								<!-- Number -->
								<div class="me-2">
									<span>Past <br> Inventory</span>
									<h3 class="mb-0 mt-2"><%= pastFlights %></h3>
								</div>
								<!-- Icon -->
								<div
									class="icon-lg rounded-circle flex-shrink-0 bg-danger bg-opacity-10 text-danger mb-0">
									<i class="bi bi-ticket-detailed fa-fw"></i>
								</div>
							</div>
							<!-- Progress bar -->
							<!-- <div class="progress progress-xs bg-danger bg-opacity-10 mb-2">
								<div class="progress-bar bg-danger" role="progressbar"
									style="width: 60%" aria-valuenow="60" aria-valuemin="0"
									aria-valuemax="100">
								</div>
							</div>
							<span><span class="text-danger">2 Cancelled flights</span> on May
								2025</span> -->
						</div>
					</div>

					<!-- Counter item -->
					<div class="col-md-6 col-xxl-3">
						<div class="card card-body shadow p-4">
							<div class="d-flex justify-content-between align-items-center mb-3">
								<!-- Number -->
								<div class="me-2">
									<span>Closed <br> Inventory</span>
									<h3 class="mb-0 mt-2"><%= closedFlights %></h3>
								</div>
								<!-- Icon -->
								<div
									class="icon-lg rounded-circle flex-shrink-0 bg-orange bg-opacity-10 text-orange mb-0">
									<i class="bi bi-ticket-perforated fa-fw"></i>
								</div>
							</div>
							<!-- Progress bar -->
							<!-- <div class="progress progress-xs bg-orange bg-opacity-10 mb-2">
								<div class="progress-bar bg-orange" role="progressbar"
									style="width: 60%" aria-valuenow="60" aria-valuemin="0"
									aria-valuemax="100">
								</div>
							</div>
							<span><span class="text-orange">2 Failed flights</span> on May
								2025</span> -->
						</div>
					</div>
				</div>
				<!-- Counter END -->

            <!-- Tabs and search START -->
            <div class="row g-4 justify-content-between align-items-center">
                <div class="col-lg-8 col-xxl-8">  
					<ul class="nav nav-pills nav-pills-primary-soft mb-3" id="tour-pills-tab" role="tablist">     
                        <li class="nav-item"> <a class="nav-link"  href="/admin/inventory/active"> Active Inventory
                            </a>
                        </li>
                        <li class="nav-item"> <a class="nav-link active"  href="/admin/inventory/past"> Past Inventory
                            </a>
                        </li> 
                           <li class="nav-item"> <a class="nav-link" href="/admin/inventory/closed"> Closed Inventory
                            </a>
                        </li> 
                    </ul>  
				</div>
                <div class="col-lg-4 col-xxl-4">
                    <!-- Tabs -->

                    <form class="rounded position-relative" method="get" action="/admin/inventory/active">
                        <input class="form-control bg-transparent pe-5" type="search" name="search"
                            placeholder="Search" aria-label="Search" value="<%= search %>">
                        <button
                            class="bg-transparent p-2 position-absolute top-50 end-0 translate-middle-y border-0 text-primary-hover "
                            type="submit">
                            <i class="fas fa-search fs-6"></i>
                        </button>
                    </form>	

                </div>

                
            </div>
            <!-- Tabs and search END -->

            <!-- Past Inventory START -->
						<div class="col-lg-12 col-xxl-12">
							<div class="card border h-100">
								<!-- Card body START -->
								<div class="card-body">
									<div class="table-responsive">
										<table class="table">

											<thead>
												<tr>
													<th>No</th>
													<th>Trip Details</th>
													<th>Seller ID <br> Agency</th>
													<th>Trip ID <br> Seats</th>
													<th>Status <br> Booking Date</th>
												</tr>
											</thead>
											<tbody>
												<% if (flights.length===0) { %>
													<div class="col">
														<h6 class="mb-0 fw-normal text-center p-4">No flights</h6>
													</div>
													<% } else { %>
														<% flights.forEach((flight,index)=> { %>
															<!-- flight card row -->
															<tr>
																<td>
																	<%= index+1 %>
																</td>
																<td>

																	<div
																		class="d-sm-flex align-items-center mb-1 mb-sm-0">
																		<!-- Avatar -->
																		<div class="avatar avatar-md flex-shrink-0">
																			<img class="rounded-circle"
																				src="<%= flight.stops[0].airlineLogo %>">
																		</div>
																		<!-- Info -->
																		<div class="ms-sm-3 mt-2 mt-sm-0">
																			<a
																				href="/admin/inventory-detail?id=<%=flight._id%>">
																				<h6 class="mb-1">
																					<%= flight.fromCity %> ‚ûù <%=
																							flight.toCity %>
																							on <%=
																								flight.stops[0]?.airline
																								%>
																				</h6>
																			</a>
																			<ul class="nav nav-divider small">
																				<li class="nav-item">
																					Trip Date: <%= flight.departureDate
																						%>
																				</li>
																			</ul>
																		</div>
																	</div>
																</td>
																<td>
																	<div class="col">
																		<small>
																			<%= flight.seller.userId %>
																		</small>
																		<h6 class="mb-0 fw-normal">
																			<%= flight.seller?.name || 'N/A' %>
																		</h6>
																	</div>
																</td>
																<% const totalSeats=flight.inventoryDates[0].seats;
																	const
																	seatsBooked=flight.inventoryDates[0].seatsBooked;
																	const availableSeats=totalSeats - seatsBooked; %>
																	<td>
																		<div class="col">
																			<small>
																				<%= flight.inventoryId %>
																			</small>
																			<h6 class="mb-0 fw-normal">
																				<%= availableSeats %> Seats
																			</h6>
																		</div>
																	</td>
																	<% const status=flight.isActive ? 'Active'
																		: 'Inactive' ; const statusClass=flight.isActive
																		? 'text-success' : 'text-danger' ; %>
																		<td>
																			<div class="col">
																				<span class="<%= statusClass %>">
																					<%= status %>
																				</span>
																				<h6 class="mb-0 fw-normal">B:<%= new
																						Date(flight.createdAt).toLocaleDateString('en-GB',
																						{ day: '2-digit' ,
																						month: 'short' , year: 'numeric'
																						}) %>
																				</h6>
																			</div>
																		</td>

															</tr>
															<% }); %>
																<% } %>

											</tbody>
										</table>
									</div>
								</div>
								<!-- Card body END -->

								<!-- Card footer START -->
								<div class="card-footer pt-0">
									<!-- Pagination and content -->
									<div class="d-sm-flex justify-content-sm-between align-items-sm-center">
										<p class="mb-sm-0 text-center text-sm-start">
											Showing <%= (currentPage - 1) * limit + 1 %> to
												<%= Math.min(currentPage * limit, totalCount) %> of
													<%= totalCount %> entries
										</p>
										<nav class="mb-sm-0 d-flex justify-content-center" aria-label="navigation">
											<ul class="pagination pagination-sm pagination-primary-soft mb-0">
												<li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
													<a class="page-link"
														href="?search=<%= search %>&page=<%= currentPage - 1 %>">Prev</a>
												</li>
												<% for (let i=1; i <=totalPages; i++) { %>
													<li class="page-item <%= i === currentPage ? 'active' : '' %>">
														<a class="page-link" href="?search=<%= search %>&page=<%= i %>">
															<%= i %>
														</a>
													</li>
													<% } %>
														<li
															class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
															<a class="page-link"
																href="?search=<%= search %>&page=<%= currentPage + 1 %>">Next</a>
														</li>
											</ul>
										</nav>
									</div>
								</div>
								<!-- Card footer END -->
							</div>
						</div>
						<!-- Past Inventory END -->
        </div>
        <!-- Page main content END -->
    </div>
    <!-- Page content END -->

</main>

<!-- **************** MAIN CONTENT END **************** -->

<%- include('./partials/footer') %>