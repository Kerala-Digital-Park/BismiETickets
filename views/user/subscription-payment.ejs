<%- include('./partials/header') %>
    <%- include('./partials/userHeader') %>

        <!-- **************** MAIN CONTENT START **************** -->
        <main>

            <!-- ======================= Content START -->
            <section class="pt-3">
                <div class="container">
                    <div class="row">

                        <%- include('./partials/userSidebar') %>

                            <!-- Main content START -->
                            <div class="col-lg-8 col-xl-9">

                                <!-- Offcanvas menu button -->
                                <div class="d-grid mb-0 d-lg-none w-100">
                                    <button class="btn btn-primary mb-4" type="button" data-bs-toggle="offcanvas"
                                        data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
                                        <i class="fas fa-sliders-h"></i> Menu
                                    </button>
                                </div>
                                <!-- Offcanvas menu button END -->

                                          <div class="card shadow p-4">
            <div class="text-center mb-4">
              <h4 class="fw-bold"><%= subscriptionDetails.subscription %> Plan (<%= subscriptionDetails.role %>)</h4>
              <p class="text-muted">Unlock premium features tailored for your business</p>
              <a href="<%= subscriptionDetails.role === 'User' ? '/subscription' : '/join-us' %>" 
                 style="float: inline-end;">
                <i class="fa-solid fa-arrow-left me-2"></i>Change Plan
              </a>
            </div>

            <% 
  let featureList = [];
  if (Array.isArray(subscriptionDetails.features)) {
    if (subscriptionDetails.features.length === 1) {
      // If features is a single string with commas → split into array
      featureList = subscriptionDetails.features[0].split(",");
    } else {
      featureList = subscriptionDetails.features;
    }
  }
%>

            <div class="row justify-content-center">
              <div class="col-md-8">
                <ul class="list-unstyled mb-0">
    <% featureList.forEach(f => { 
      const featureText = (f || '').trim(); 
      const lowerText = featureText.toLowerCase(); 
      const isNegative = lowerText.startsWith('no ') || lowerText.startsWith('limited');
    %>
      <li class="mb-2">
        <i class="bi <%= isNegative ? 'bi-x-circle text-danger' : 'bi-check-circle text-success' %> me-2"></i>
        <%= featureText %>
      </li>
    <% }) %>
  </ul>

                <div class="text-center mt-4">
                  <p class="mb-1">
                    <strong class="fs-3 text-dark">₹ <%= subscriptionDetails.price %></strong> / Month
                  </p>
                  <button class="btn btn-primary btn-lg w-50 mt-3" id="payNowBtn">Pay Now</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Hidden HDFC Payment Form -->
  <form id="hdfcSubscriptionForm" method="POST" action="/payment/initiate-subscription" style="display: none;">
    <input type="hidden" name="email" />
    <input type="hidden" name="price" />
    <input type="hidden" name="subscription" />
    <input type="hidden" name="role" />
  </form>

  <script>
    document.getElementById("payNowBtn").addEventListener("click", function () {
      const email = "<%= userDetails.email %>";
      const subscription = "<%= subscriptionDetails.subscription %>";
      const role = "<%= subscriptionDetails.role %>";
      const amount = "<%= subscriptionDetails.price %>";

      const form = document.getElementById("hdfcSubscriptionForm");
      form.email.value = email;
      form.price.value = amount;
      form.subscription.value = subscription;
      form.role.value = role;
      form.submit();
    });
  </script>
</main>
        <!-- **************** MAIN CONTENT END **************** -->

        <%- include('./partials/footer') %>