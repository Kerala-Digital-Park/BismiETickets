<%- include('./partials/header') %>

<!-- **************** MAIN CONTENT START **************** -->
<main>
  <!-- =======================
    Main Content START -->
  <section class="vh-xxl-100">
    <div class="container h-100 d-flex px-0 px-sm-4">
      <div class="row justify-content-center align-items-center m-auto">
        <div class="col-12">
          <div class="bg-mode shadow rounded-3 overflow-hidden">
            <div class="row g-0">
              
              <!-- Information -->
              <div class="col-lg-6 order-1">
                <div class="p-4 p-sm-7">
                  <!-- Logo -->
                  <a href="/">
                    <img
                      class="mb-4 h-50px"
                      src="/assets/images/logo-light.svg"
                      alt="logo"
                    />
                  </a>
                  <!-- Title -->
                  <h1 class="mb-2 h3">Reset password</h1>
                  <p class="mb-sm-0">
                    Enter your new password.
                  </p>
                  <% if (message) { %>
                    <div class="alert alert-<%= messageType === 'success' ? 'success' : 'danger' %>" role="alert">
                      <%= message %>
                    </div>
                  <% } %>
                  <!-- Form START -->
                  <form class="mt-sm-4 text-start" action="/reset-password?token=<%= token %>" method="POST">

<!-- Password -->
<div class="mb-3 position-relative">
  <label class="form-label">Enter password</label>
  <input class="form-control" type="password" id="psw-input" name="password">
  <span class="position-absolute top-50 end-0 translate-middle-y p-0 mt-3">
    <i class="toggle-password fas fa-eye-slash cursor-pointer p-2" data-target="psw-input"></i>
  </span>
</div>

<!-- Password Rules -->
<div id="password-rules-container" class="d-none">
  <ul id="password-rules" class="text-danger small ps-3 mb-3" style="list-style: none;">
    <li id="rule-length" style="font-size: smaller;">❌ Minimum 8 characters</li>
    <li id="rule-upper" style="font-size: smaller;">❌ At least 1 uppercase letter</li>
    <li id="rule-lower" style="font-size: smaller;">❌ At least 1 lowercase letter</li>
    <li id="rule-number" style="font-size: smaller;">❌ At least 1 number</li>
    <li id="rule-special" style="font-size: smaller;">❌ At least 1 special character (@, #, $, *)</li>
  </ul>
</div>

<!-- Confirm Password (hidden by default) -->
<div id="confirm-container" class="mb-3 position-relative d-none">
  <label class="form-label">Confirm Password</label>
  <input type="password" class="form-control" id="confirm-psw-input" name="confirmPassword">
  <span class="position-absolute top-50 end-0 translate-middle-y p-0 mt-3">
    <i class="toggle-password fas fa-eye-slash cursor-pointer p-2" data-target="confirm-psw-input"></i>
  </span>
  <p id="confirm-message" class="small mt-1"></p>
</div>

<!-- Button -->
<div class="d-grid">
  <button type="submit" id="reset-btn" class="btn btn-primary" disabled>
    Reset Password
  </button>
</div>

                    <!-- Copyright -->
                    <div class="text-primary-hover text-body mt-3 text-center">
                      Copyrights ©2025 BismiETickets. Build by <a
                          href="https://www.keraladigitalpark.com/"
                          class="text-body">Kerala Digital Park</a>.
                  </div>
                  </form>
                  <!-- Form END -->
                </div>
              </div>

              <!-- Vector Image -->
              <div
                class="col-lg-6 d-md-flex align-items-center order-2 order-lg-1"
              >
                <!-- Divider -->
                <div class="vr opacity-1 d-none d-lg-block"></div>
                <div class="p-3 p-lg-5">
                  <img src="/assets/images/element/forgot-pass.svg" alt="" />
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    // Eye toggle
    document.querySelectorAll(".toggle-password").forEach(function (toggleIcon) {
      toggleIcon.addEventListener("click", function () {
        const targetId = this.getAttribute("data-target");
        const input = document.getElementById(targetId);
        if (input) {
          input.type = input.type === "password" ? "text" : "password";
          this.classList.toggle("fa-eye");
          this.classList.toggle("fa-eye-slash");
        }
      });
    });

    const passwordInput = document.getElementById("psw-input");
    const confirmInput = document.getElementById("confirm-psw-input");
    const confirmContainer = document.getElementById("confirm-container");
    const rulesContainer = document.getElementById("password-rules-container");
    const confirmMsg = document.getElementById("confirm-message");
    const resetBtn = document.getElementById("reset-btn");

    const ruleLength = document.getElementById("rule-length");
    const ruleUpper = document.getElementById("rule-upper");
    const ruleLower = document.getElementById("rule-lower");
    const ruleNumber = document.getElementById("rule-number");
    const ruleSpecial = document.getElementById("rule-special");

    function validatePassword() {
      const value = passwordInput.value;
      rulesContainer.classList.remove("d-none");

      let valid = true;

      if (value.length >= 8) ruleLength.innerHTML = "✅ Minimum 8 characters"; else {ruleLength.innerHTML = "❌ Minimum 8 characters"; valid = false;}
      if (/[A-Z]/.test(value)) ruleUpper.innerHTML = "✅ At least 1 uppercase letter"; else {ruleUpper.innerHTML = "❌ At least 1 uppercase letter"; valid = false;}
      if (/[a-z]/.test(value)) ruleLower.innerHTML = "✅ At least 1 lowercase letter"; else {ruleLower.innerHTML = "❌ At least 1 lowercase letter"; valid = false;}
      if (/[0-9]/.test(value)) ruleNumber.innerHTML = "✅ At least 1 number"; else {ruleNumber.innerHTML = "❌ At least 1 number"; valid = false;}
      if (/[@#$*]/.test(value)) ruleSpecial.innerHTML = "✅ At least 1 special character (@, #, $, *)"; else {ruleSpecial.innerHTML = "❌ At least 1 special character (@, #, $, *)"; valid = false;}

      // Show confirm password only if all rules pass
      confirmContainer.classList.toggle("d-none", !valid);

      return valid;
    }

    function validateConfirm() {
      if (confirmInput.value === "") {
        confirmMsg.textContent = "";
        return false;
      }
      if (passwordInput.value === confirmInput.value) {
        confirmMsg.textContent = "✅ Passwords match";
        confirmMsg.classList.remove("text-danger");
        confirmMsg.classList.add("text-success");
        return true;
      } else {
        confirmMsg.textContent = "❌ Passwords do not match";
        confirmMsg.classList.remove("text-success");
        confirmMsg.classList.add("text-danger");
        return false;
      }
    }

    function updateButtonState() {
      if (validatePassword() && validateConfirm()) {
        resetBtn.disabled = false;
      } else {
        resetBtn.disabled = true;
      }
    }

    passwordInput.addEventListener("input", () => {
      validatePassword();
      updateButtonState();
    });

    confirmInput.addEventListener("input", () => {
      validateConfirm();
      updateButtonState();
    });
  });
</script>

  <!-- =======================
    Main Content END -->
</main>
<!-- **************** MAIN CONTENT END **************** -->
