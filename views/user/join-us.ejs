<%- include('./partials/header') %>
<%- include('./partials/userHeader') %>

<!-- **************** MAIN CONTENT START **************** -->
<main>
	
    <!-- =======================
    Main Banner START -->
    <section class="pt-4 pt-md-5">
        <div class="container">
            <div class="row g-4 align-items-center">				
                <div class="col-lg-7">
                    <!-- Title -->
                    <h1 class="mb-4 display-5">List your flight groups on <span class="text-primary">Btrips</span></h1>
                    <!-- Info -->
                    <p class="mb-4">Travel agencies have the opportunity to sell their own groups and restricted seats on our portal.
 Simple and convenient options.
 Please subscribe to a plan and complete Kyc before adding.</p>
                    <!-- Button -->
                    <button onclick="addListing()" class="btn btn-primary-soft mb-4">Add Listing <i class="fa-solid fa-arrow-right-long fa-fw"></i></button>
                    <!-- List -->
                    <h6 class="fw-normal mb-1">Create New Listing</h6>
                    <ul class="list-group list-group-borderless mb-0 small">
                        <li class="list-group-item d-flex mb-0">
                            <i class="fa-solid fa-check-circle text-success me-2 mt-1"></i>Over 1000 flight groups listed
                        </li>
                        <li class="list-group-item d-flex mb-0">
                            <i class="fa-solid fa-check-circle text-success me-2 mt-1"></i>Easy and convenient tools to sell and customize
                        </li>
                        <li class="list-group-item d-flex mb-0">
                            <i class="fa-solid fa-check-circle text-success me-2 mt-1"></i>Utility opportunity to add services to your groups
                        </li>
                    </ul>
                </div>
                <!-- Image -->
                <div class="col-lg-5 text-center">
                    <img src="assets/images/element/join-us.svg" alt="">
                </div>
            </div>
        </div>
    </section>
    <!-- =======================
    Main Banner END -->
    
    <!-- =======================
    Counter START -->
    <section class="pt-0">
        <div class="container">
            <div class="row g-4 align-items-center">
                <!-- Title -->
                <div class="col-sm-6 col-md-3">
                    <h4 class="mb-0">Numbers In Worldwide</h4>
                </div>
                
                <!-- Counter item -->
                <div class="col-sm-6 col-md-3">
                    <div class="card card-body text-center bg-light">
                        <div class="d-flex justify-content-center">
                            <h3 class="purecounter text-orange mb-0" data-purecounter-start="0" data-purecounter-end="28"	data-purecounter-delay="300">0</h3>
                            <span class="h3 text-orange mb-0">M+</span>
                        </div>
                        <h6 class="fw-normal mb-0">Total Users</h6>
                    </div>
                </div>
                
                <!-- Counter item -->
                <div class="col-sm-6 col-md-3">
                    <div class="card card-body text-center bg-light">
                        <div class="d-flex justify-content-center">
                            <h3 class="purecounter text-info mb-0" data-purecounter-start="0" data-purecounter-end="51"	data-purecounter-delay="300">0</h3>
                            <span class="h3 text-info mb-0">M+</span>
                        </div>
                        <h6 class="fw-normal mb-0">Total Listing</h6>
                    </div>
                </div>
                
                <!-- Counter item -->
                <div class="col-sm-6 col-md-3">
                    <div class="card card-body text-center bg-light">
                        <div class="d-flex justify-content-center">
                            <h3 class="purecounter text-primary mb-0" data-purecounter-start="0" data-purecounter-end="41"	data-purecounter-delay="300">0</h3>
                            <span class="h3 text-primary mb-0">+</span>
                        </div>
                        <h6 class="fw-normal mb-0">Languages</h6>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- =======================
    Counter END -->
    
    <!-- =======================
    Benefits START -->
    <section class="pt-0 pt-md-5">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="bg-light p-4 p-sm-5 rounded-3">
                        <!-- Title -->
                        <h2 class="fs-3 text-center mb-4 mb-sm-5">Why Working with us</h2>
    
                        <div class="row g-4">
                            <!-- Card START -->
                            <div class="col-md-6">
                                <div class="card card-body p-4">
                                 <div><img src="assets/images/element/18.svg" class="h-70px mb-3" alt=""></div> 
                                    <h5>List flight groups</h5>
                                    <p class="mb-0">Sell quickly and complete your group fill, you can list flights. Groups, held seats or restricted seats can be allowed for sale.</p>
                                </div>
                            </div>
                            <!-- Card END -->
    
                            <!-- Card START -->
                            <div class="col-md-6">
                                <div class="card card-body p-4">
                                    <div><img src="assets/images/element/21.svg" class="h-70px mb-3" alt=""></div>
                                    <h5>Import detail easily</h5>
                                    <p class="mb-0">Once inventory is added, quickly approve it for public purchase. There is no automated process for approval.</p>
                                </div>
                            </div>
                            <!-- Card END -->
    
                            <!-- Card START -->
                            <div class="col-md-6">
                                <div class="card card-body p-4">
                                    <div><img src="assets/images/element/19.svg" class="h-70px mb-3" alt=""></div>
                                    <h5>Step by step guide</h5>
                                    <p class="mb-0">The lists are completely filled with bad things. Points are feared, but the law may end. All bad sellers notice their bad things and get tired of them or prevent further sales.</p>
                                </div>
                            </div>
                            <!-- Card END -->
    
                            <!-- Card START -->
                            <div class="col-md-6">
                                <div class="card card-body p-4">
                                    <div><img src="assets/images/element/20.svg" class="h-70px mb-3" alt=""></div>
                                    <h5>Marvelous discounts</h5>
                                    <p class="mb-0">List groups can be allocated special promotions to increase sales, and exclusive coupons can also be allocated. It helps to increase sales and reviews.</p>
                                </div>
                            </div>
                            <!-- Card END -->
    
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- =======================
    Benefits END -->
    
    <!-- =======================
    Testimonials START -->
    <section>
        
        <div class="container" id="pricing">
            <div class="row">
                <!-- Title -->
                <div class="col-xl-10 mx-auto text-center">
                    <h1 class="mb-2">Plan That Fit Your
                        <span class="position-relative z-index-9">Scale
                            <!-- SVG START -->
                            <span
                                class="position-absolute top-50 start-50 translate-middle z-index-n1 d-none d-sm-block">
                                <svg width="203.94px" height="54.13px" viewBox="0 0 203.94 54.13">
                                    <path class="fill-primary opacity-7"
                                        d="M126.49,49.51c19.28,0.32,33.97,0.06,48.55-2.07c5.25-0.77,10.43-2.14,15.54-3.6c2.26-0.64,4.43-1.95,6.35-3.36 c3.16-2.32,3.37-4.88,0.61-7.62c-1.84-1.82-3.96-3.42-6.16-4.8c-5.74-3.6-12.04-6.02-18.4-8.28c-15.69-5.58-31.86-9.17-48.29-11.7 c-18.65-2.87-37.4-4.07-56.26-3.51C54.54,5,40.71,6.16,26.99,8.39C19.25,9.65,11.5,10.9,3.76,12.15c-0.1,0.02-0.2,0.04-0.3,0.05 c-2.03,0.27-3.23-0.26-3.44-1.51c-0.2-1.22,0.72-2.05,2.84-2.45c13.24-2.51,26.48-5.11,39.9-6.43c14.43-1.42,28.9-2.13,43.42-1.67 c24.63,0.78,48.89,4.14,72.7,10.58c9.42,2.55,18.73,5.54,27.54,9.77c4.06,1.95,7.9,4.39,11.66,6.88c1.63,1.08,3.02,2.69,4.15,4.32 c2.53,3.63,2.27,7.63-0.89,10.71c-1.84,1.79-4.08,3.29-6.38,4.45c-5.44,2.75-11.4,3.91-17.38,4.77c-19.2,2.75-38.5,2.96-57.84,1.98 c-7.84-0.4-15.68-0.74-23.5-1.34c-10.13-0.77-20.26-1.58-30.36-2.72c-9.49-1.07-18.96-2.38-28.37-4.01 C32.2,44.6,26.97,43,21.81,41.34c-2.44-0.78-4.81-2.13-6.86-3.69c-4.56-3.49-4.8-8.3-0.9-12.54c2.3-2.5,5.23-4.07,8.3-5.36 c6.9-2.91,14.13-4.64,21.46-5.97c10.14-1.84,20.37-2.47,30.66-1.92c2.57,0.14,3.72,0.84,3.6,2.22c-0.11,1.26-1.19,1.84-3.6,1.92 c-6.13,0.21-12.28,0.2-18.4,0.67c-10.47,0.82-20.72,2.87-30.56,6.62c-2.23,0.85-4.45,1.95-6.4,3.31c-4.53,3.16-4.36,6.27,0.46,8.87 c2.28,1.23,4.75,2.19,7.24,2.97c7.8,2.44,15.84,3.88,23.93,4.79c15.4,1.73,30.8,3.38,46.24,4.67 C108.32,48.84,119.7,49.15,126.49,49.51z" />
                                </svg>
                            </span>
                            <!-- SVG END -->
                        </span>
                    </h1>
                    <p class="lead mb-0">Simple, transparent pricing that grows with you. Try any plan free for
                        30 days</p>

                    <!-- Switch START -->
                    <form class="d-flex align-items-center justify-content-center mt-5">
                        <!-- Label -->
                        <span class="h6 mb-0 fw-bold">Monthly</span>
                        <!-- Switch -->
                        <div class="form-check form-switch form-check-lg mx-3 mb-0">
                            <input class="form-check-input mt-0 price-toggle" type="checkbox"
                                id="flexSwitchCheckDefault">
                        </div>
                        <!-- Label -->
                        <div class="position-relative">
                            <span class="h6 mb-0 fw-bold">Yearly</span>
                            <span
                                class="rotate-10 badge text-bg-warning ms-1 position-absolute top-0 start-100 translate-middle mt-n4 ms-n7 ms-sm-n3">10%
                                discount</span>
                        </div>
                    </form>
                    <!-- Switch END -->
                </div>
            </div> 
            <h6 class="text-primary text-center mt-5">Agent Pricing</h6>
<div class="row g-4 justify-content-center mt-1">
    <% subscriptions.forEach(plan => { 
        <!-- if (plan.type !== 'Agent') return; // If you separate agent plans by type in DB -->
        let featureList = [];
        if (Array.isArray(plan.features)) {
            if (plan.features.length === 1) {
                featureList = plan.features[0].split(",");
            } else {
                featureList = plan.features;
            }
        }
        const annualPrice = plan.price * 12;
        const isCurrent = user?.subscription?.subscription === plan.subscription;
        const currentPrice = user?.subscription?.price || 0;
    %>
    <div class="col-md-6 col-lg-4">
        <div class="card shadow">
            <!-- Card header -->
            <div class="card-header d-flex justify-content-between align-items-center border-bottom p-4">
                <div>
                    <h6 class="mb-0"><%= plan.subscription %> Plan</h6>
                    <div class="hstack gap-2">
                        <span class="h3 plan-price mb-0"
                              data-monthly-price="₹<%= plan.price %>"
                              data-annual-price="₹<%= annualPrice.toFixed(0) %>">
                              ₹<%= plan.price %>
                        </span>
                        <span class="h6 fw-light mb-0">/ per user</span>
                    </div>
                </div>
                <span class="icon-lg rounded-circle" data-bs-toggle="tooltip" data-bs-placement="top" title="<%= plan.badge || '' %>">
                    <img src="<%= plan.icon || '/assets/images/element/plan-s1.svg' %>" alt="<%= plan.subscription %> Icon" class="img-fluid" style="max-width: 100px;">
                </span>
            </div>

            <!-- Card body -->
            <div class="card-body p-4">
                <ul class="list-unstyled mb-0">
                    <% featureList.forEach(f => {
                        const featureText = (f || '').trim();
                        const lowerText = featureText.toLowerCase();
                        const isNegative = lowerText.startsWith('no ') || lowerText.startsWith('limited');
                    %>
                        <li class="mb-2">
                            <i class="bi <%= isNegative ? 'bi-x-circle text-danger' : 'bi-check-circle text-success' %> me-2"></i>
                            <%= featureText %>
                        </li>
                    <% }) %>
                </ul>
            </div>

            <!-- Card footer -->
            <div class="card-footer p-4 pt-0">
                <% if (user) { %>
                    <% if (isCurrent) { %>
                        <button class="btn btn-success w-100 mb-0" disabled>Current Plan</button>
                    <% } else if (plan.price < currentPrice) { %>
                        <% if (plan.price === 0) { %>
                            <button class="btn btn-dark w-100 mb-0" onclick="agentDowngrade('<%= plan.subscription %>')">Downgrade</button>
                            
                        <% } else { %>
                            <button class="btn btn-dark w-100 mb-0" onclick="agentDowngrade('<%= plan.subscription %>')">Downgrade</button>
                        <% } %>
                    <% } else { %>
                        <button class="btn btn-dark w-100 mb-0" onclick="agentCheckout('<%= plan.subscription %>')">Get Started</button>
                    <% } %>
                <% } else { %>
                    <button class="btn btn-dark w-100 mb-0" onclick="agentCheckout('<%= plan.subscription %>')">Get Started</button>
                <% } %>
            </div>
        </div>
    </div>
    <% }) %>
</div>

        </div>
    </section>
    <!-- =======================
    Testimonials END -->
    
    <!-- =======================
    Action box START -->
    <section>
        <div class="container">
            <div class="row g-4">
                <div class="col-12">
                    <!-- Action box START -->
                    <div class="card card-body shadow p-4">
                        <div class="row g-4 justify-content-between align-items-center">
                            <!-- Image -->
                            <div class="col-sm-3 col-lg-2">
                                <img src="assets/images/element/22.svg" alt="">
                            </div>
    
                            <!-- Title and content -->
                            <div class="col-sm-9 col-lg-6 col-xl-7">
                                <h4>Are you having trouble joining?</h4>
                                <p class="mb-0">We are ready to help and support you with any issues joining our seller platforms. Don't hesitate, you can contact us via email. Please click the button and share it.</p>
                            </div>
    
                            <!-- Button -->
                            <div class="col-lg-3 col-xxl-2 d-grid">
                                <a href="#" class="btn btn-primary mb-0">Become a host</a>
                            </div>
                        </div>
                    </div>
                    <!-- Action box END -->
                </div>
            </div>
        </div>
    </section>
    <!-- =======================
    Action box END -->
    
    <script>
        async function addListing() {
          const user = <%- JSON.stringify(user) %>;
      
          if (user) {
            if (user.userRole === 'Agent') {
              window.location.href = '/add-listing';
            } else {
              await Swal.fire({
          icon: 'warning',
          title: 'Access Denied',
          text: 'You must be an agent to access this page.'
        });
              window.location.href = "#pricing";
            }
          } else {
            window.location.href = "/sign-in";
          }
        }
    </script>
      
   <script>
async function agentCheckout(subscription) {
    try {
        const response = await fetch("/agent-subscription", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ subscription })
        });

        if (!response.ok) {
            await Swal.fire({
                icon: 'error',
                title: 'Failed',
                text: 'Failed to fetch subscription details'
            });
            return;
        }

        const data = await response.json();
        if (data.message) {
            await Swal.fire({
                icon: 'info',
                title: 'Notice',
                text: data.message
            });
        }
        window.location.href = data.redirectUrl;
    } catch (error) {
        console.error("Error:", error);
        window.location.href = "/sign-in";
    }
}

async function agentDowngrade(subscription) {
    const confirm = await Swal.fire({
        icon: 'warning',
        title: 'Are you sure?',
        text: `Do you want to downgrade to the ${subscription} plan?`,
        showCancelButton: true,
        confirmButtonText: 'Yes, downgrade',
        cancelButtonText: 'Cancel'
    });

    if (!confirm.isConfirmed) return;

    try {
        const response = await fetch("/agent-subscription", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ subscription })
        });

        if (!response.ok) {
            await Swal.fire({
                icon: 'error',
                title: 'Failed',
                text: 'Failed to fetch subscription details'
            });
            return;
        }

        const data = await response.json();
        if (data.message) {
            await Swal.fire({
                icon: 'info',
                title: 'Notice',
                text: data.message
            });
        }
        window.location.href = data.redirectUrl;
    } catch (error) {
        console.error("Error:", error);
        window.location.href = "/sign-in";
    }
}
</script>


    </main>
    <!-- **************** MAIN CONTENT END **************** -->

<%- include('./partials/footer') %>