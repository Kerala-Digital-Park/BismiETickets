<%- include('./partials/header') %>
	<%- include('./partials/userHeader') %>

		<!-- **************** MAIN CONTENT START **************** -->
		<main>
			<!-- =======================
Page banner START -->
			<% if(bookings) { %>
				<section class="py-0">
					<div class="container">
						<!-- Card START -->
						<div class="card bg-light overflow-hidden px-sm-5">
							<div class="row align-items-center g-4">

								<!-- Content -->
								<div class="col-sm-9">
									<div class="card-body">
										<!-- Breadcrumb -->
										<nav aria-label="breadcrumb">
											<ol class="breadcrumb breadcrumb-dots mb-0">
												<li class="breadcrumb-item"><a href="/"><i class="bi bi-house me-1"></i>
														Home</a></li>
												<li class="breadcrumb-item">My listing</li>
												<li class="breadcrumb-item active">
													<%= bookings.flight.inventoryId %>
												</li>
												<% let status="" ; let statusClass="" ; if(bookings.flight.isActive)
													{ status="Active" ; statusClass="text-success" ; } else {
													status="Inactive" ; statusClass="text-danger" ; } %>
													<li class="breadcrumb-item active <%= statusClass %>">
														<%= status %>
													</li>
											</ol>
										</nav>
										<!-- Title -->
										<h1 class="m-0 h4 card-title">
											<%= bookings.flight.fromCity %> ➝ <%= bookings.flight.toCity %> on <%= new Date(bookings.flight.departureDate).toDateString() %>
										</h1>
									</div>
								</div>

								<!-- Image -->
								<div class="col-sm-3 text-end d-none d-sm-block">
									<img src="assets/images/bannerFlightGrey.svg" class="mb-n1" alt="">
								</div>
							</div>
						</div>
						<!-- Card END -->
					</div>
			<% } else { %>
					<div class="alert alert-warning mb-0" role="alert">
						<i class="fa-solid fa-exclamation-triangle me-2"></i>
						No bookings found
					</div>
				</section>
			<% } %>
						<!-- =======================
Page banner END -->
						<!-- ======================= Title and notice board START -->

<% if (success) { %>
  <div class="d-flex justify-content-center mt-3">
    <div class="alert alert-success text-center" style="width: 80%;"><%= success %></div>
  </div>
<% } %>

<% if (error) { %>
  <div class="d-flex justify-content-center mt-3">
    <div class="alert alert-danger text-center" style="width: 80%;"><%= error %></div>
  </div>
<% } %>

		<section>
			<div class="container">
			<!-- Tabs START -->
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="bg-light pb-0 px-2 px-lg-0 rounded-top">
                            <ul class="nav nav-tabs nav-bottom-line nav-responsive border-0 nav-justified"
                                role="tablist">
                                <li class="nav-item"> <a class="nav-link mb-0 active" data-bs-toggle="tab"
                                        href="#tab-1"><i class="bi bi-bookmark-heart fa-fw me-1"></i> Booking
                                        Details</a> </li>
                                <li class="nav-item"> <a class="nav-link mb-0" data-bs-toggle="tab"
                                        href="#tab-2"><i class="fa-fw bi bi-life-preserver me-2"></i>
                                        Transactions</a> </li>
                                <li class="nav-item"> <a class="nav-link mb-0" data-bs-toggle="tab"
                                        href="#tab-3"><i class="bi bi-patch-question"></i> Manage
                                        Requests</a> </li>
                            <li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" href="#" id="dropdoanMenu" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<i class="bi bi-list-ul fa-fw me-1"></i>Booking Actions
								</a>
								  <ul class="dropdown-menu" aria-labelledby="dropdoanMenu">
    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#inventoryModal" data-flight="<%= JSON.stringify(bookings.flight) %>"><i class="bi bi-card-checklist"></i> Edit Inventory Details</a></li>
    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#flightDetailModal" data-flight="<%= JSON.stringify(bookings.flight) %>"><i class="bi bi-airplane"></i> Edit Flight Details</a></li>
    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#baggageModal" data-flight="<%= JSON.stringify(bookings.flight) %>"><i class="bi bi-luggage-fill"></i> Edit Baggage Details</a></li>
  </ul>
							</li>	    
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Tabs END -->

				<!-- Left side content START -->
                <div class="tab-content">
					<% if(bookings) { %>
                    <!-- Tab content 1 START -->
                    <div class="tab-pane show active" id="tab-1">
                        <div class="row g-4 g-lg-5">
                            <div class="col-xl-12">
                                <div class="vstack gap-3">

                                    <!-- Flight information START -->
                                    <div class="card shadow">
                                        <!-- Card header -->
                                        <div class="card-header border-bottom d-md-flex justify-content-md-between">
                                            <!-- Title -->
                                            <h6 class="mb-0"><i class="fas fa-plane-departure"></i> Booking
                                                Information</h6>
                                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
  <!-- Yes button -->
  <input type="radio" class="btn-check"
         name="btnradio"
         id="btnradio1"
         <% if (bookings.flight.isActive) { %> checked <% } %> >
  <label class="btn btn-outline-success btn-sm mb-0
         <% if (bookings.flight.isActive) { %> active <% } %>"
         for="btnradio1">
    <i class="bi bi-eye"></i> Active
  </label>

  <!-- No button -->
  <input type="radio" class="btn-check"
         name="btnradio"
         id="btnradio2" 
         <% if (!bookings.flight.isActive) { %> checked <% } %> >
  <label class="btn btn-outline-danger btn-sm mb-0
         <% if (!bookings.flight.isActive) { %> active <% } %>"
         for="btnradio2">
    Inactive <i class="bi bi-eye-slash"></i>
  </label>
</div>

                                        </div>

                                        <!-- Card body START -->
                                        <div class="card-body p-2">
                                            <!-- Card list START -->
                                            <!-- Card header -->
                                            <div
                                                class="card-header d-sm-flex justify-content-sm-between align-items-center">
                                                <!-- Airline Name -->
                                                <div class="d-flex align-items-center mb-2 mb-sm-0">
                                                    <img src="<%= bookings.flight.stops[0].airlineLogo %>" class="w-30px me-2"
                                                        alt="">
                                                    <h6 class="fw-normal mb-0"><%= bookings.flight.stops[0].airline %>
																					( <%= bookings.flight.stops[0].airlineCode
																						%> - <%=
																							bookings.flight.stops[0].flightNumber
																							%> )</h6>
                                                </div>
                                                <h6 class="fw-normal mb-0">
  <span class="text-body">Booking PNR:</span>
  <% 
    let pnr;
    if (bookings.flight.inventoryDates && bookings.flight.inventoryDates.length > 0) {
      pnr = bookings.flight.inventoryDates[0].pnr;
    } else {
      pnr = 'N/A';
    }  
  %>
  <%= pnr %>
</h6>
                                            </div>
                                            <!-- Card body -->
                                            <div class="card-body p-4">
  <% if (bookings.flight.stops.length === 1) { %>
    <!-- Direct Flight -->
    <div class="row g-4">
      <!-- From Airport -->
      <div class="col-sm-4">
        <h4><%= bookings.flight.from.toUpperCase() %></h4>
        <h6 class="mb-0"><%= bookings.flight.departureTime %></h6>
        <p class="mb-0"><%= bookings.flight.departureName %></p>
      </div>

      <!-- Duration -->
      <div class="col-sm-5 col-md-4 my-sm-auto text-center">
        <h5><%= bookings.flight.duration %></h5>
        <div class="position-relative my-4">
          <hr class="bg-primary opacity-5 position-relative">
          <div class="icon-md bg-primary text-white rounded-circle position-absolute top-50 start-50 translate-middle">
            <i class="fa-solid fa-fw fa-plane rtl-flip"></i>
          </div>
        </div>
      </div>

      <!-- To Airport -->
      <div class="col-sm-4">
        <h4><%= bookings.flight.to.toUpperCase() %></h4>
        <h6 class="mb-0"><%= bookings.flight.arrivalTime %></h6>
        <p class="mb-0"><%= bookings.flight.arrivalName %></p>
      </div>
    </div>

  <% } else { %>
    <!-- Multi-stop flight -->
    <% for (let i = 0; i < bookings.flight.stops.length; i++) { 
      const stop = bookings.flight.stops[i];
    %>
      <div class="row g-4">
        <!-- From Airport -->
        <div class="col-sm-4">
          <h4><%= stop.from.toUpperCase() %></h4>
          <h6 class="mb-0"><%= stop.departureTime %></h6>
          <p class="mb-0">Terminal: <%= stop.fromTerminal || 'N/A' %></p>
        </div>

        <!-- Duration -->
        <div class="col-sm-5 col-md-4 my-sm-auto text-center">
          <h5><%= stop.stopDuration || 'Flight segment' %></h5>
          <div class="position-relative my-4">
            <hr class="bg-primary opacity-5 position-relative">
            <div class="icon-md bg-primary text-white rounded-circle position-absolute top-50 start-50 translate-middle">
              <i class="fa-solid fa-fw fa-plane rtl-flip"></i>
            </div>
          </div>
        </div>

        <!-- To Airport -->
        <div class="col-sm-4">
          <h4><%= stop.to.toUpperCase() %></h4>
          <h6 class="mb-0"><%= stop.arrivalTime %></h6>
          <p class="mb-0">Terminal: <%= stop.toTerminal || 'N/A' %></p>
        </div>
      </div>

      <!-- LAYOVER (Only if there's a next stop) -->
      <% if (i < bookings.flight.stops.length - 1) {
        const currentArrival = new Date(stop.arrivalTime);
        const nextDeparture = new Date(bookings.flight.stops[i + 1].departureTime);

        const layoverMinutes = Math.floor((nextDeparture - currentArrival) / (1000 * 60));
        const layoverHours = Math.floor(layoverMinutes / 60);
        const layoverMins = layoverMinutes % 60;
        const layoverCity = stop.to;

        const layoverString = `${layoverHours}h ${layoverMins}m Layover in ${layoverCity}`;
      %>
        <div class="bg-light text-center fw-normal rounded-2 mt-3 mb-4 p-2">
          Change of planes: <%= layoverString %>
        </div>
      <% } %>
    <% } %>
  <% } %>
</div>

                                             <div class="card-footer pt-4">
                                                <ul
                                                    class="list-inline bg-light rounded-2 d-sm-flex text-center justify-content-sm-between mb-0 px-4 py-2">
                                                    <li class="list-inline-item"> <span class="text-danger"><%= bookings.flight.inventoryDates[0].seatsBooked %>
                                                            Sold Seats </span>| <span class="text-info"></span>Total <%= bookings.flight.inventoryDates[0].seats %>
                                                        Seats</span></li>
                                                    <li class="list-inline-item text-primary">Checked baggage : 25 kg
                                                    </li>
                                                    <li class="list-inline-item text-primary">Carry-on baggage : 7 Kg
                                                    </li>
                                                    <li class="list-inline-item text-primary">Travel Class : Economy
                                                    </li>
                                                </ul>
                                            </div>

                                            <!-- Card list END -->
                                        </div>
                                        <!-- Card body END -->
                                    </div>
                                    <!-- Flight information END -->
                                    <!-- Information START -->

                                    <div class="card border mt-3">
                                        <!-- Card header -->
                                        <div class="card-header border-bottom d-md-flex justify-content-md-between">
                                            <h6 class="card-title mb-0">Passengers Information</h6>
                                            <a href="#" onclick="window.location.reload(true);" class="btn btn-outline-info btn-sm mb-0"><i class="bi bi-arrow-clockwise"></i> Refresh List</a>
                                        </div>

                                        <!-- Card body START -->
                                         <div class="card-body">
                                            <div class="col-md-12">
                                                <div class="table-responsive">
                                                    <table class="datatable-init-export nowrap table"
                                                        data-export-title="Export">

                                                        <thead>

                                                            <tr>
                                                                <th>No</th>

                                                                <th>TYPE</th>

                                                                <th>TITLE</th>

                                                                <th>FIRST NAME</th>

                                                                <th>LAST NAME</th>

                                                                <th>DOB </th>

                                                                <th>Gender </th>

                                                                <th>View</th>

                                                            </tr>

                                                        </thead>

                                                        <tbody>
													<% bookings.travelers.forEach((traveler, index)=> { %>

                                                            <tr>
                                                                <td><%= index+1 %></td>

                                                                <td><%= traveler.type %></td>

                                                                <td><%= traveler.title %></td>

                                                                <td><%= traveler.first_name %></td>

                                                                <td><%= traveler.last_name %></td>

                                                                <td><%= new Date(traveler.dob).toLocaleDateString('en-US',
																	{ year: 'numeric', month: 'long', day: 'numeric'}) %></td>
                                                                
                                                                <%
                                                                let gender;
                                                                 if(traveler.type === "Miss" || traveler.type === "Mrs" || traveler.type === "Ms") {
                                                                    gender = "Female";
                                                                } else {
                                                                    gender = "Male"
                                                                }
                                                                %>
                                                                <td> <%= gender %> </td>

                                                                <td>
  <button class="btn btn-sm btn-outline-primary mb-0"
    data-bs-toggle="modal"
    data-bs-target="#travelerModal<%= index %>"
    title="More Details">
    <i class="bi bi-eye-fill"></i>
  </button>
</td>


                                                            </tr>
                                                            <% }) %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <!-- Information END -->
                                        </div>
									</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <% bookings.travelers.forEach((traveler, index) => { 
  const gender = (traveler.type === "Miss" || traveler.type === "Mrs" || traveler.type === "Ms") ? "Female" : "Male";
%>
<div class="modal fade" id="travelerModal<%= index %>" tabindex="-1" aria-labelledby="travelerModalLabel<%= index %>" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="travelerModalLabel<%= index %>">Traveler Details - <%= traveler.first_name %> <%= traveler.last_name %></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
              <p><strong>Title:</strong> <%= traveler.title %></p>
              <p><strong>First Name:</strong> <%= traveler.first_name %></p>
              <p><strong>Last Name:</strong> <%= traveler.last_name %></p>
              <p><strong>Type:</strong> <%= traveler.type %></p>
            <p><strong>Gender:</strong> <%= gender %></p>
          </div>
          <div class="col-md-6">
            <p><strong>Date of Birth:</strong> <%= new Date(traveler.dob).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric'}) %></p>
            <p><strong>Nationality:</strong> <%= traveler.nationality %></p>
            <p><strong>Passport Number:</strong> <%= traveler.passport_number %></p>
            <p><strong>Passport Country:</strong> <%= traveler.passport_country %></p>
            <p><strong>Passport Expiry:</strong> <%= new Date(traveler.passport_expiry).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric'}) %></p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<% }) %>

                    <!-- Tab content 1 END -->
                    <!-- Tab content 2 START -->
                    <div class="tab-pane" id="tab-2">
                        <!-- Payment Options START -->
                        <div class="card shadow">
                            <!-- Card header -->
                            <div class="card-header border-bottom p-4">
                                <!-- Title -->
                                <h6 class="card-title mb-0"><i class="bi bi-wallet-fill me-2"></i>Transactions
                                </h6>
                            </div>

                            <!-- Card body START -->
                            <div class="card-body p-4 pb-0">
                                <!-- Accordion START -->
                                <div class="table-responsive">
  <table class="table table-bordered align-middle text-center mb-0">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>Transaction ID</th>
        <th>Base Fare</th>
        <th>Tax</th>
        <th>Discount</th>
        <th>Total Amount</th>
        <th>Status</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      <% if (transaction.length > 0) { %>
        <% transaction.forEach((trx, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><%= trx.transactionId %></td>
            <td>₹<%= trx.baseFare.toFixed(2) %></td>
            <td>₹<%= trx.tax.toFixed(2) %></td>
            <td>₹<%= trx.discount.toFixed(2) %></td>
            <td><strong>₹<%= trx.totalAmount.toFixed(2) %></strong></td>
            <td>
              <% if (trx.paymentStatus === 'Paid') { %>
                <span class="badge bg-success">Paid</span>
              <% } else { %>
                <span class="badge bg-warning text-dark">Unpaid</span>
              <% } %>
            </td>
            <td><%= new Date(trx.createdAt).toLocaleString('en-IN', {
                  day: '2-digit',
                  month: 'short',
                  year: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                }) %></td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="10" class="text-center text-muted">No transactions found</td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>

                                <!-- Accordion END -->
                            </div>
                            <!-- Card body END -->

                            <div class="card-footer p-4 pt-0">
                                <!-- Condition link -->

                            </div>
                        </div>
                        <!-- Payment Options END -->
                    </div>
                    <!-- Tab content 2 END -->
                    <!-- Tab content 3 START -->
                    <div class="tab-pane" id="tab-3">
  <div class="row">
    <div class="col-12 mx-auto">
      <div class="accordion accordion-icon accordion-bg-light" id="accordionExample2">

        <% if (requests && requests.length > 0) { %>
          <% requests.forEach((req, index) => { %>
            <div class="accordion-item mb-3">
              <h6 class="accordion-header font-base" id="heading-<%= index %>">
                <button class="accordion-button fw-bold rounded d-inline-block collapsed"
                  type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= index %>"
                  aria-expanded="false" aria-controls="collapse-<%= index %>">
                  Support Request Number : <%= req.requestId %>
                </button>
              </h6>
              <div id="collapse-<%= index %>" class="accordion-collapse collapse"
                aria-labelledby="heading-<%= index %>" data-bs-parent="#accordionExample2">
                <div class="accordion-body mt-3">
                  <div class="card shadow">
                    <div class="card-header border-bottom p-4">
                      <h6 class="mb-0"><%= req.subject %></h6>
                      <ul class="nav nav-divider">
                        <li class="nav-item">Last updated: <%= req.updatedAt.toLocaleDateString("en-GB") %></li>
                      </ul>
                    </div>
                    <div class="card-body p-4">
                      <div class="alert alert-warning text-right" role="alert">
                        <%= req.passengerName %> - <%= req.request %>
                      </div>
                    </div>
                    <div class="card-footer border-0 p-4 pt-0">
                      <div class="border p-3 rounded d-lg-flex align-items-center justify-content-between text-center">
                        <small class="py-3 py-lg-0 d-block">
                          We believe the problem has been resolved. Give us the rates for your satisfaction.
                        </small>
                        <div class="btn-group" role="group" aria-label="Feedback">
                          <input type="radio" class="btn-check" name="feedback-<%= index %>" id="btnradio1-<%= index %>">
                          <label class="btn btn-outline-light btn-sm mb-0" for="btnradio1-<%= index %>">
                            <i class="fa-solid fa-thumbs-up me-1"></i> Yes
                          </label>

                          <input type="radio" class="btn-check" name="feedback-<%= index %>" id="btnradio2-<%= index %>">
                          <label class="btn btn-outline-light btn-sm mb-0" for="btnradio2-<%= index %>">
                            No <i class="fa-solid fa-thumbs-down ms-1"></i>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="border p-3 rounded d-lg-flex align-items-center justify-content-between text-center">
            <small class="py-3 py-lg-0 d-block">No Request Found</small>
          </div>
        <% } %>

      </div>
    </div>
  </div>
                    </div>
                    <!-- Tab content 3 END -->

					<% } else { %>
						<div class="alert alert-warning mb-0" role="alert">
							<i class="fa-solid fa-exclamation-triangle me-2"></i>
							No bookings found
						</div>
					<% } %>
                </div> <!-- Row END -->
            </div>
        </section>

						<script>
							document.addEventListener('DOMContentLoaded', function () {
								const flightDetailButtons = document.querySelectorAll('.flight-detail-btn');

								flightDetailButtons.forEach(button => {
									button.addEventListener('click', function () {
										const flightData = JSON.parse(this.getAttribute('data-flight'));
										const userData = JSON.parse(this.getAttribute('data-user'));

										const stops = flightData.stops || [];

										// ========= Flight Info Tab =========
										const flightInfoTab = document.getElementById('flight-info-tab');

										// Clear previous content
										flightInfoTab.innerHTML = '';

										// Create card wrapper
										const card = document.createElement('div');
										card.className = 'card border';

										// Card header
										const cardHeader = document.createElement('div');
										cardHeader.className = 'card-header';

										const headerFlex = document.createElement('div');
										headerFlex.className = 'd-sm-flex justify-content-sm-between align-items-center';

										const airlineDiv = document.createElement('div');
										airlineDiv.className = 'd-flex mb-2 mb-sm-0';

										const airlineImg = document.createElement('img');
										airlineImg.src = stops[0]?.airlineLogo || 'assets/images/element/09.svg';
										airlineImg.className = 'w-40px me-2';
										airlineImg.alt = '';

										const airlineText = document.createElement('h6');
										airlineText.className = 'fw-normal mb-0';
										airlineText.textContent = `${stops[0]?.airline || 'Airline'} (${stops[0]?.airlineCode} - ${stops[0]?.flightNumber})`;

										airlineDiv.appendChild(airlineImg);
										airlineDiv.appendChild(airlineText);

										const travelClass = document.createElement('h6');
										travelClass.className = 'fw-normal mb-0';

										headerFlex.appendChild(airlineDiv);
										headerFlex.appendChild(travelClass);
										cardHeader.appendChild(headerFlex);
										card.appendChild(cardHeader);

										// Card body
										const cardBody = document.createElement('div');
										cardBody.className = 'card-body p-4';

										// Loop through stops and render each segment
										for (let i = 0; i < stops.length; i++) {
											const stop = stops[i];
											const nextStop = stops[i + 1];

											const row = document.createElement('div');
											row.className = 'row g-4';

											// From Airport
											const fromCol = document.createElement('div');
											fromCol.className = 'col-sm-4';
											fromCol.innerHTML = `
						<h4>${stop.fromCode.toUpperCase()}</h4>
						<h6 class="mb-0">${stop.departureTime}</h6>
						<p class="mb-0">${stop.departureCity}, ${stop.from}</p>
						`;

											// Flight Duration
											const midCol = document.createElement('div');
											midCol.className = 'col-sm-4 my-sm-auto text-center';
											midCol.innerHTML = `
						<h5>${stop.stopDuration}</h5>
						<div class="position-relative my-4">
						<hr class="bg-primary opacity-5 position-relative">
						<div class="icon-md bg-primary text-white rounded-circle position-absolute top-50 start-50 translate-middle">
						  <i class="fa-solid fa-fw fa-plane rtl-flip"></i>
						</div>
						</div>
						`;

											// To Airport
											const toCol = document.createElement('div');
											toCol.className = 'col-sm-4';
											toCol.innerHTML = `
						<h4>${stop.toCode.toUpperCase()}</h4>
						<h6 class="mb-0">${stop.arrivalTime}</h6>
						<p class="mb-0">${stop.arrivalCity}, ${stop.to}</p>
						`;

											row.appendChild(fromCol);
											row.appendChild(midCol);
											row.appendChild(toCol);

											cardBody.appendChild(row);

											// Add Layover if not last stop

											if (nextStop) {
												// Parse arrival time of current stop and departure time of next stop
												const arrivalTime = stop.arrivalTime; // e.g., "17:25"
												const nextDepartureTime = nextStop.departureTime; // e.g., "18:40"

												// Convert both to minutes
												const [arrHr, arrMin] = arrivalTime.split(':').map(Number);
												const [depHr, depMin] = nextDepartureTime.split(':').map(Number);

												const arrivalInMinutes = arrHr * 60 + arrMin;
												const departureInMinutes = depHr * 60 + depMin;

												let layoverMin = departureInMinutes - arrivalInMinutes;

												// Handle overnight flights (e.g., arrival at 23:30, departure at 01:15 next day)
												if (layoverMin < 0) layoverMin += 24 * 60;

												// Convert to hrs and mins
												const layoverHr = Math.floor(layoverMin / 60);
												const layoverMins = layoverMin % 60;

												// Create layover text
												let layoverText = 'Layover: ';
												if (layoverHr > 0) layoverText += `${layoverHr} hr `;
												if (layoverMins > 0 || layoverHr === 0) layoverText += `${layoverMins} min `;
												layoverText += `in ${stop.arrivalCity}`;

												const layoverDiv = document.createElement('div');
												layoverDiv.className = 'bg-light text-center fw-normal rounded-2 mt-3 mb-4 p-2 text-danger';
												layoverDiv.textContent = layoverText;

												cardBody.appendChild(layoverDiv);
											}

										}

										card.appendChild(cardBody);
										flightInfoTab.appendChild(card);

										// ========= Baggage Tab =========
										const baggageTab = document.getElementById('flight-baggage-tab');
										baggageTab.innerHTML = ''; // Clear previous

										const baggage = flightData.baggage || {};
										const baggageCard = document.createElement('div');
										baggageCard.className = 'card border';

										const baggageHeader = document.createElement('div');
										baggageHeader.className = 'card-header d-flex align-items-center border-bottom';
										baggageHeader.innerHTML = `
				  <img src="assets/images/element/09.svg" class="h-20px me-1" alt="">
				  <h5 class="card-title mb-0">${stops[0]?.fromCode.toUpperCase()} - ${stops[stops.length - 1]?.toCode.toUpperCase()}</h5>
				`;
										baggageCard.appendChild(baggageHeader);

										const baggageBody = document.createElement('div');
										baggageBody.className = 'card-body';
										baggageBody.innerHTML = `
				  <div class="table-responsive-lg">
					<table class="table caption-bottom mb-0">
					  <caption class="pb-0">*1PC = 30KG</caption>
					  <thead class="table-dark">
						<tr>
						  <th scope="col" class="border-0 rounded-start">Baggage Type</th>
						  <th scope="col" class="border-0">Check In</th>
						  <th scope="col" class="border-0 rounded-end">Cabin</th>
						</tr>
					  </thead>
					  <tbody class="border-top-0">
						${baggage.adult ? `
						  <tr>
							<td>Adult</td>
							<td>${baggage.adult.checkIn.numberOfPieces} PC </td>
							<td>${baggage.adult.cabin.weightPerPiece} Kg</td>
						  </tr>` : ''
											}
						${baggage.child ? `
						  <tr>
							<td>Child</td>
							<td>${baggage.child.checkIn.numberOfPieces} PC</td>
							<td>${baggage.child.cabin.weightPerPiece} Kg</td>
						  </tr>` : ''
											}
						${baggage.infant ? `
						  <tr>
							<td>Infant</td>
							<td>${baggage.infant.checkIn.numberOfPieces} PC </td>
							<td>${baggage.infant.cabin.weightPerPiece} Kg</td>
						  </tr>` : ''
											}
					  </tbody>
					</table>
				  </div>
				`;
										baggageCard.appendChild(baggageBody);
										baggageTab.appendChild(baggageCard);

										// fare
										const fare = flightData.inventoryDates?.[0]?.fare?.adults || 0;

										let serviceCharge = 400; // default

										if (userData?.subscription?.serviceCharge) {
											serviceCharge = userData.subscription.serviceCharge;
										}
										const taxPercent = (serviceCharge * 18) / 100
										const taxAndFees = serviceCharge + taxPercent;
										const totalFees = fare + taxAndFees;

										// Fill the fare table
										document.querySelector("#flight-fare-tab tbody").innerHTML = `
				  <tr>
					<td>₹${fare}</td>
					<td>₹${taxAndFees.toFixed(2)}</td>
					<td><h5 class="mb-0">₹${totalFees.toFixed(2)}</h5></td>
				  </tr>
				`;

									});
								});
							});
						</script>

						<script>
							document.addEventListener("DOMContentLoaded", function () {
								document.querySelectorAll(".traveler-summary").forEach(row => {
									row.addEventListener("click", function () {
										const index = row.getAttribute("data-index");
										const detailsRow = document.getElementById("details-" + index);
										const isVisible = detailsRow.style.display === "table-row";
										detailsRow.style.display = isVisible ? "none" : "table-row";
									});
								});
							});
						</script>

				<div class="modal fade" id="flightModal" tabindex="-1" aria-labelledby="flightModalLabel"
					aria-hidden="true">
					<div class="modal-dialog modal-lg">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="flightModalLabel">Update Flight</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal"
									aria-label="Close"></button>
							</div>

							<div class="modal-body">
								<form id="flightForm">
									<input type="hidden" name="flightId" id="flightId">
									<div class="row g-3">
										<!-- Row 1 -->
										<div class="col-md-3">
											<label class="form-label">Inventory ID</label>
											<input type="text" class="form-control" id="inventoryId">
										</div>

										<div class="col-md-4">
											<label class="form-label">From</label>
											<input type="text" class="form-control" id="from">
										</div>

										<div class="col-md-4">
											<label class="form-label">To</label>
											<input type="text" class="form-control" id="to">
										</div>

										<div class="col-md-3">
											<label class="form-label">From Code</label>
											<input type="text" class="form-control" id="fromCode">
										</div>

										<div class="col-md-3">
											<label class="form-label">To Code</label>
											<input type="text" class="form-control" id="toCode">
										</div>

										<div class="col-md-3">
											<label class="form-label">Departure Date</label>
											<input type="text" class="form-control dateInput" id="departureDate">
										</div>

										<div class="col-md-3">
											<label class="form-label">Arrival Date</label>
											<input type="text" class="form-control dateInput" id="arrivalDate">
										</div>

										<div class="col-md-3">
											<label class="form-label">Departure Time</label>
											<input type="time" class="form-control" id="departureTime">
										</div>

										<div class="col-md-3">
											<label class="form-label">Arrival Time</label>
											<input type="time" class="form-control" id="arrivalTime">
										</div>

										<div class="col-md-3">
											<label class="form-label">Duration(in sec)</label>
											<input type="text" class="form-control" id="duration">
										</div>

										<div class="col-md-3">
											<label class="form-label">From City</label>
											<input type="text" class="form-control" id="fromCity">
										</div>

										<div class="col-md-3">
											<label class="form-label">To City</label>
											<input type="text" class="form-control" id="toCity">
										</div>

										<div class="col-md-3">
											<label class="form-label">From Country</label>
											<input type="text" class="form-control" id="fromCountry">
										</div>

										<div class="col-md-3">
											<label class="form-label">To Country</label>
											<input type="text" class="form-control" id="toCountry">
										</div>

										<!-- Row 2 -->

										<div id="stopsContainer" class="row g-3 stop-block"></div>

										<!-- Row 3 -->
										<div class="col-md-3">
											<label class="form-label">PNR</label>
											<input type="text" class="form-control" id="pnr">
										</div>

										<div class="col-md-3">
											<label class="form-label">Seats</label>
											<input type="number" class="form-control" id="seats">
										</div>

										<div class="col-md-3">
											<label class="form-label">Adults ₹</label>
											<input type="number" class="form-control" id="adults">
										</div>

										<div class="col-md-3">
											<label class="form-label">Infants ₹</label>
											<input type="number" class="form-control" id="infants">
										</div>

										<div class="col-md-3">
											<label class="form-label">Cabin Weight</label>
											<input type="text" class="form-control" id="cab">
										</div>

										<div class="col-md-3">
											<label class="form-label">CheckIn Weight</label>
											<input type="text" class="form-control" id="checkin">
										</div>

										<div class="col-md-3">
											<label class="form-label">Status</label>
											<select class="form-select" id="status">
												<option value="active">Active</option>
												<option value="inactive">Inactive</option>
											</select>
										</div>

									</div>
								</form>
							</div>

							<div class="modal-footer">
								<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
								<button type="submit" id="updateFlightBtn" class="btn btn-primary">Update</button>
							</div>
						</div>
					</div>
				</div>

				<script>
					const flightModal = document.getElementById('flightModal');

					flightModal.addEventListener('show.bs.modal', function (event) {
						const button = event.relatedTarget;
						const flightData = JSON.parse(button.getAttribute('data-flight'));

						// Main flight details
						document.getElementById('flightId').value = flightData._id;
						document.getElementById('inventoryId').value = flightData.inventoryId || '';
						document.getElementById('from').value = flightData.departureName || '';
						document.getElementById('to').value = flightData.arrivalName || '';
						document.getElementById('fromCode').value = flightData.from || '';
						document.getElementById('toCode').value = flightData.to || '';
						document.getElementById('departureDate').value = flightData.departureDate || '';
						document.getElementById('arrivalDate').value = flightData.arrivalDate || '';
						document.getElementById('departureTime').value = flightData.departureTime || '';
						document.getElementById('arrivalTime').value = flightData.arrivalTime || '';
						document.getElementById('duration').value = flightData.duration || '';
						document.getElementById('fromCity').value = flightData.fromCity || '';
						document.getElementById('toCity').value = flightData.toCity || '';
						document.getElementById('fromCountry').value = flightData.fromCountry || '';
						document.getElementById('toCountry').value = flightData.toCountry || '';

						// Clear existing stops if any
						const stopsContainer = document.getElementById('stopsContainer');
						stopsContainer.innerHTML = '';

						// Add stops dynamically
						if (flightData.stops && flightData.stops.length > 0) {
							flightData.stops.forEach((stop, index) => {
								const stopHTML = `
				<div class="col-12"><hr><strong>Stop ${index}</strong></div>
				<div class="col-md-4">
				  <label class="form-label">From</label>
				  <input type="text" class="form-control stop-from" value="${stop.from || ''}" >
				</div>
				<div class="col-md-4">
				  <label class="form-label">To</label>
				  <input type="text" class="form-control stop-from" value="${stop.to || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">From Code</label>
				  <input type="text" class="form-control stop-from-code" value="${stop.fromCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">To Code</label>
				  <input type="text" class="form-control stop-to-code" value="${stop.toCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">From Terminal</label>
				  <input type="text" class="form-control stop-from-terminal" value="${stop.fromTerminal || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">To Terminal</label>
				  <input type="text" class="form-control stop-to-terminal" value="${stop.toTerminal || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Flight Number</label>
				  <input type="text" class="form-control stop-flight-number" value="${stop.flightNumber || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline</label>
				  <input type="text" class="form-control stop-airline" value="${stop.airline || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure Date</label>
				  <input type="text" class="form-control stop-departure-day dateInput" value="${stop.departureDay || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival Date</label>
				  <input type="text" class="form-control stop-arrival-day dateInput" value="${stop.arrivalDay || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure Time</label>
				  <input type="time" class="form-control stop-departure-time" value="${stop.departureTime || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival Time</label>
				  <input type="time" class="form-control stop-arrival-time" value="${stop.arrivalTime || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Stop Duration (in sec)</label>
				  <input type="text" class="form-control stop-duration" value="${stop.stopDuration || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure City</label>
				  <input type="text" class="form-control stop-departure-city" value="${stop.departureCity || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival City</label>
				  <input type="text" class="form-control stop-arrival-city" value="${stop.arrivalCity || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline Code</label>
				  <input type="text" class="form-control stop-airline-code" value="${stop.airlineCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline Logo</label>
				  <input type="text" class="form-control stop-airline-logo" value="${stop.airlineLogo || ''}" >
				</div>
			  `;
								stopsContainer.insertAdjacentHTML('beforeend', stopHTML);
							});
						}

						// Pricing and baggage
						const invDate = flightData.inventoryDates?.[0] || {};
						document.getElementById('pnr').value = invDate.pnr || '';
						document.getElementById('seats').value = invDate.seats || '';
						document.getElementById('adults').value = invDate.fare?.adults || '';
						document.getElementById('infants').value = invDate.fare?.infants || '';
						document.getElementById('cab').value = flightData.baggage?.adult?.cabin?.weightPerPiece || '';
						document.getElementById('checkin').value = flightData.baggage?.adult?.checkIn?.weightPerPiece || '';

						// Status
						document.getElementById('status').value = flightData.status || 'inactive';
					});
				</script>

                <div class="modal fade" id="inventoryModal" tabindex="-1" aria-labelledby="inventoryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Inventory Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="inventoryForm">
          <input type="hidden" id="flightIdInventory">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Inventory ID</label>
              <input type="text" class="form-control" id="inventoryId" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">PNR</label>
              <input type="text" class="form-control" id="pnr" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">Seats</label>
              <input type="number" class="form-control" id="seats">
            </div>
            <div class="col-md-6">
              <label class="form-label">Adults ₹</label>
              <input type="number" class="form-control" id="adults">
            </div>
            <div class="col-md-6">
              <label class="form-label">Infants ₹</label>
              <input type="number" class="form-control" id="infants">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" id="updateInventoryBtn">Update</button>
      </div>
    </div>
  </div>
</div>

<script>
					const inventoryModal = document.getElementById('inventoryModal');

					flightModal.addEventListener('show.bs.modal', function (event) {
						const button = event.relatedTarget;
						const flightData = JSON.parse(button.getAttribute('data-flight'));

						// Main flight details
						document.getElementById('flightId').value = flightData._id;
						document.getElementById('inventoryId').value = flightData.inventoryId || '';
						// Pricing and baggage
						const invDate = flightData.inventoryDates?.[0] || {};
						document.getElementById('pnr').value = invDate.pnr || '';
						document.getElementById('seats').value = invDate.seats || '';
						document.getElementById('adults').value = invDate.fare?.adults || '';
						document.getElementById('infants').value = invDate.fare?.infants || '';

					});
				</script>

<div class="modal fade" id="flightDetailModal" tabindex="-1" aria-labelledby="flightDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Flight Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="flightForm">
          <input type="hidden" id="flightIdFlight">
          <div class="row g-3">
            <div class="col-md-3">
											<label class="form-label">Inventory ID</label>
											<input type="text" class="form-control" id="inventoryId">
										</div>

										<div class="col-md-4">
											<label class="form-label">From</label>
											<input type="text" class="form-control" id="from">
										</div>

										<div class="col-md-4">
											<label class="form-label">To</label>
											<input type="text" class="form-control" id="to">
										</div>

										<div class="col-md-3">
											<label class="form-label">From Code</label>
											<input type="text" class="form-control" id="fromCode">
										</div>

										<div class="col-md-3">
											<label class="form-label">To Code</label>
											<input type="text" class="form-control" id="toCode">
										</div>

										<div class="col-md-3">
											<label class="form-label">Departure Date</label>
											<input type="text" class="form-control dateInput" id="departureDate">
										</div>

										<div class="col-md-3">
											<label class="form-label">Arrival Date</label>
											<input type="text" class="form-control dateInput" id="arrivalDate">
										</div>

										<div class="col-md-3">
											<label class="form-label">Departure Time</label>
											<input type="time" class="form-control" id="departureTime">
										</div>

										<div class="col-md-3">
											<label class="form-label">Arrival Time</label>
											<input type="time" class="form-control" id="arrivalTime">
										</div>

										<div class="col-md-3">
											<label class="form-label">Duration(in sec)</label>
											<input type="text" class="form-control" id="duration">
										</div>

										<div class="col-md-3">
											<label class="form-label">From City</label>
											<input type="text" class="form-control" id="fromCity">
										</div>

										<div class="col-md-3">
											<label class="form-label">To City</label>
											<input type="text" class="form-control" id="toCity">
										</div>

										<div class="col-md-3">
											<label class="form-label">From Country</label>
											<input type="text" class="form-control" id="fromCountry">
										</div>

										<div class="col-md-3">
											<label class="form-label">To Country</label>
											<input type="text" class="form-control" id="toCountry">
										</div>

                                        <div class="col-md-3">
											<label class="form-label">Status</label>
											<select class="form-select" id="status">
												<option value="active">Active</option>
												<option value="inactive">Inactive</option>
											</select>
										</div>
          </div>
          										<div id="stopsContainer" class="row g-3 stop-block"></div>

        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" id="updateFlightBtn">Update</button>
      </div>
    </div>
  </div>
</div>

<script>
					const flightModal = document.getElementById('flightModal');

					flightModal.addEventListener('show.bs.modal', function (event) {
						const button = event.relatedTarget;
						const flightData = JSON.parse(button.getAttribute('data-flight'));

						// Main flight details
						document.getElementById('flightId').value = flightData._id;
						document.getElementById('inventoryId').value = flightData.inventoryId || '';
						document.getElementById('from').value = flightData.departureName || '';
						document.getElementById('to').value = flightData.arrivalName || '';
						document.getElementById('fromCode').value = flightData.from || '';
						document.getElementById('toCode').value = flightData.to || '';
						document.getElementById('departureDate').value = flightData.departureDate || '';
						document.getElementById('arrivalDate').value = flightData.arrivalDate || '';
						document.getElementById('departureTime').value = flightData.departureTime || '';
						document.getElementById('arrivalTime').value = flightData.arrivalTime || '';
						document.getElementById('duration').value = flightData.duration || '';
						document.getElementById('fromCity').value = flightData.fromCity || '';
						document.getElementById('toCity').value = flightData.toCity || '';
						document.getElementById('fromCountry').value = flightData.fromCountry || '';
						document.getElementById('toCountry').value = flightData.toCountry || '';

						// Clear existing stops if any
						const stopsContainer = document.getElementById('stopsContainer');
						stopsContainer.innerHTML = '';

						// Add stops dynamically
						if (flightData.stops && flightData.stops.length > 0) {
							flightData.stops.forEach((stop, index) => {
								const stopHTML = `
				<div class="col-12"><hr><strong>Stop ${index}</strong></div>
				<div class="col-md-4">
				  <label class="form-label">From</label>
				  <input type="text" class="form-control stop-from" value="${stop.from || ''}" >
				</div>
				<div class="col-md-4">
				  <label class="form-label">To</label>
				  <input type="text" class="form-control stop-from" value="${stop.to || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">From Code</label>
				  <input type="text" class="form-control stop-from-code" value="${stop.fromCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">To Code</label>
				  <input type="text" class="form-control stop-to-code" value="${stop.toCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">From Terminal</label>
				  <input type="text" class="form-control stop-from-terminal" value="${stop.fromTerminal || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">To Terminal</label>
				  <input type="text" class="form-control stop-to-terminal" value="${stop.toTerminal || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Flight Number</label>
				  <input type="text" class="form-control stop-flight-number" value="${stop.flightNumber || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline</label>
				  <input type="text" class="form-control stop-airline" value="${stop.airline || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure Date</label>
				  <input type="text" class="form-control stop-departure-day dateInput" value="${stop.departureDay || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival Date</label>
				  <input type="text" class="form-control stop-arrival-day dateInput" value="${stop.arrivalDay || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure Time</label>
				  <input type="time" class="form-control stop-departure-time" value="${stop.departureTime || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival Time</label>
				  <input type="time" class="form-control stop-arrival-time" value="${stop.arrivalTime || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Stop Duration (in sec)</label>
				  <input type="text" class="form-control stop-duration" value="${stop.stopDuration || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure City</label>
				  <input type="text" class="form-control stop-departure-city" value="${stop.departureCity || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival City</label>
				  <input type="text" class="form-control stop-arrival-city" value="${stop.arrivalCity || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline Code</label>
				  <input type="text" class="form-control stop-airline-code" value="${stop.airlineCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline Logo</label>
				  <input type="text" class="form-control stop-airline-logo" value="${stop.airlineLogo || ''}" >
				</div>
			  `;
								stopsContainer.insertAdjacentHTML('beforeend', stopHTML);
							});
						}

						// Pricing and baggage
						const invDate = flightData.inventoryDates?.[0] || {};
						document.getElementById('pnr').value = invDate.pnr || '';
						document.getElementById('seats').value = invDate.seats || '';
						document.getElementById('adults').value = invDate.fare?.adults || '';
						document.getElementById('infants').value = invDate.fare?.infants || '';
						document.getElementById('cab').value = flightData.baggage?.adult?.cabin?.weightPerPiece || '';
						document.getElementById('checkin').value = flightData.baggage?.adult?.checkIn?.weightPerPiece || '';

						// Status
						document.getElementById('status').value = flightData.status || 'inactive';
					});
				</script>

<div class="modal fade" id="baggageModal" tabindex="-1" aria-labelledby="baggageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Baggage Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="baggageForm">
          <input type="hidden" id="flightIdBaggage">
          <div class="row g-3 mb-3">
            <h6>Adult</h6>
            <div class="col-md-6">
              <label class="form-label">Cabin Weight</label>
              <input type="text" class="form-control" id="cab">
            </div>
            <div class="col-md-6">
              <label class="form-label">Check-In Weight</label>
              <input type="text" class="form-control" id="checkin">
            </div>
          </div>
          <div class="row g-3 mb-3">
            <h6>Children</h6>
            <div class="col-md-6">
              <label class="form-label">Cabin Weight</label>
              <input type="text" class="form-control" id="cab">
            </div>
            <div class="col-md-6">
              <label class="form-label">Check-In Weight</label>
              <input type="text" class="form-control" id="checkin">
            </div>
          </div>
          <div class="row g-3 mb-3">
            <h6>Infant</h6>
            <div class="col-md-6">
              <label class="form-label">Cabin Weight</label>
              <input type="text" class="form-control" id="cab">
            </div>
            <div class="col-md-6">
              <label class="form-label">Check-In Weight</label>
              <input type="text" class="form-control" id="checkin">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" id="updateBaggageBtn">Update</button>
      </div>
    </div>
  </div>
</div>

<script>
					const flightModal = document.getElementById('flightModal');

					flightModal.addEventListener('show.bs.modal', function (event) {
						const button = event.relatedTarget;
						const flightData = JSON.parse(button.getAttribute('data-flight'));

						// Main flight details
						document.getElementById('flightId').value = flightData._id;
						document.getElementById('inventoryId').value = flightData.inventoryId || '';
						document.getElementById('from').value = flightData.departureName || '';
						document.getElementById('to').value = flightData.arrivalName || '';
						document.getElementById('fromCode').value = flightData.from || '';
						document.getElementById('toCode').value = flightData.to || '';
						document.getElementById('departureDate').value = flightData.departureDate || '';
						document.getElementById('arrivalDate').value = flightData.arrivalDate || '';
						document.getElementById('departureTime').value = flightData.departureTime || '';
						document.getElementById('arrivalTime').value = flightData.arrivalTime || '';
						document.getElementById('duration').value = flightData.duration || '';
						document.getElementById('fromCity').value = flightData.fromCity || '';
						document.getElementById('toCity').value = flightData.toCity || '';
						document.getElementById('fromCountry').value = flightData.fromCountry || '';
						document.getElementById('toCountry').value = flightData.toCountry || '';

						// Clear existing stops if any
						const stopsContainer = document.getElementById('stopsContainer');
						stopsContainer.innerHTML = '';

						// Add stops dynamically
						if (flightData.stops && flightData.stops.length > 0) {
							flightData.stops.forEach((stop, index) => {
								const stopHTML = `
				<div class="col-12"><hr><strong>Stop ${index}</strong></div>
				<div class="col-md-4">
				  <label class="form-label">From</label>
				  <input type="text" class="form-control stop-from" value="${stop.from || ''}" >
				</div>
				<div class="col-md-4">
				  <label class="form-label">To</label>
				  <input type="text" class="form-control stop-from" value="${stop.to || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">From Code</label>
				  <input type="text" class="form-control stop-from-code" value="${stop.fromCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">To Code</label>
				  <input type="text" class="form-control stop-to-code" value="${stop.toCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">From Terminal</label>
				  <input type="text" class="form-control stop-from-terminal" value="${stop.fromTerminal || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">To Terminal</label>
				  <input type="text" class="form-control stop-to-terminal" value="${stop.toTerminal || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Flight Number</label>
				  <input type="text" class="form-control stop-flight-number" value="${stop.flightNumber || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline</label>
				  <input type="text" class="form-control stop-airline" value="${stop.airline || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure Date</label>
				  <input type="text" class="form-control stop-departure-day dateInput" value="${stop.departureDay || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival Date</label>
				  <input type="text" class="form-control stop-arrival-day dateInput" value="${stop.arrivalDay || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure Time</label>
				  <input type="time" class="form-control stop-departure-time" value="${stop.departureTime || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival Time</label>
				  <input type="time" class="form-control stop-arrival-time" value="${stop.arrivalTime || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Stop Duration (in sec)</label>
				  <input type="text" class="form-control stop-duration" value="${stop.stopDuration || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Departure City</label>
				  <input type="text" class="form-control stop-departure-city" value="${stop.departureCity || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Arrival City</label>
				  <input type="text" class="form-control stop-arrival-city" value="${stop.arrivalCity || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline Code</label>
				  <input type="text" class="form-control stop-airline-code" value="${stop.airlineCode || ''}" >
				</div>
				<div class="col-md-3">
				  <label class="form-label">Airline Logo</label>
				  <input type="text" class="form-control stop-airline-logo" value="${stop.airlineLogo || ''}" >
				</div>
			  `;
								stopsContainer.insertAdjacentHTML('beforeend', stopHTML);
							});
						}

						// Pricing and baggage
						const invDate = flightData.inventoryDates?.[0] || {};
						document.getElementById('pnr').value = invDate.pnr || '';
						document.getElementById('seats').value = invDate.seats || '';
						document.getElementById('adults').value = invDate.fare?.adults || '';
						document.getElementById('infants').value = invDate.fare?.infants || '';
						document.getElementById('cab').value = flightData.baggage?.adult?.cabin?.weightPerPiece || '';
						document.getElementById('checkin').value = flightData.baggage?.adult?.checkIn?.weightPerPiece || '';

						// Status
						document.getElementById('status').value = flightData.status || 'inactive';
					});
				</script>

						<!-- ======================= Flight list END -->
		</main>
		<!-- **************** MAIN CONTENT END **************** -->

		<%- include('./partials/footer') %>